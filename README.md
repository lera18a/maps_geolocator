## Maps Geolocator

Учебное Flutter-приложение с экраном карты, которое показывает текущее местоположение пользователя и рисует маршрут движения. Приложение корректно обрабатывает ситуацию, когда пользователь сначала запретил доступ к геолокации, а затем разрешил доступ через **Настройки** — после возврата в приложение трекинг запускается заново автоматически.

---

## Что делает приложение

- Открывает карту **OpenStreetMap** (через `flutter_map`)
- Определяет текущее местоположение пользователя
- Показывает пользователя на карте **маркером**
- По мере движения добавляет точки и рисует **линию маршрута (polyline)**
- Поддерживает режим **Follow me**: карта автоматически центрируется на пользователе
- Если пользователь двигает карту вручную — режим Follow me отключается
- Если доступ к геолокации запрещён — показывает диалог и предлагает открыть настройки

---

## Зачем нужен этот проект

Этот проект — пример того, как во Flutter:

- работать с геолокацией через `geolocator`
- получать координаты один раз (`determinePosition`)
- подписываться на поток координат (`getPositionStream`)
- рисовать трек на карте (polyline)
- восстанавливать работу геолокации после изменения разрешений в настройках приложения

---

## Как работает логика

### 1) Запуск экрана
При открытии экрана в `initState()` вызывается `_startTracking()`:

- `determinePosition()` проверяет:
  - включены ли службы геолокации (GPS)
  - есть ли разрешение у приложения на доступ к геопозиции
- если всё ок — сохраняем координаты в `_me`
- затем запускаем обновления координат через `Geolocator.getPositionStream()`

### 2) Если доступа к геолокации нет
Если `determinePosition()` не может получить координаты (например `denied` или `deniedForever`):

- показываем `GeolocationDeniedDialog`
- если пользователь нажимает **Settings** — открываем настройки приложения через `Geolocator.openAppSettings()`
- ставим флаг `_openedSettings = true`, чтобы понимать, что пользователь ушёл в настройки именно из этого экрана

### 3) Возврат из настроек
`WidgetsBindingObserver` отслеживает `AppLifecycleState.resumed` (возврат в приложение):

- если `_openedSettings == true`:
  - сбрасываем флаг
  - повторно запускаем `_startTracking()`
- это позволяет заново проверить разрешения и включить трекинг без перезапуска приложения

---

## Результат для пользователя

Пользователь открывает карту и видит:

- своё текущее местоположение
- свой маршрут перемещения (линия на карте)
- понятное сообщение и кнопку перехода в настройки, если геолокация отключена